# TODO
# google doc: bashrc, venv, tmux, storing things locally on the machines themselves
train victims round robin
visualize victims
train a baseline attacker
train white box attackers: act/value, latents, both

# repos
https://github.com/PavelCz/multiagent-competition/tree/master/gym_compete
https://github.com/HumanCompatibleAI/adversarial-policies
https://github.com/openai/multiagent-competition

# ssh
ssh scasper@align-2.csail.mit.edu

# env
python -m venv ~/mc_env
source ~/mc_env/bin/activate
python -m pip install patchelf numpy gym scipy matplotlib Cython pyglet mujoco>=2.1
python -m pip install torch torchvision --extra-index-url https://download.pytorch.org/whl/cu113
python -m pip install git+https://github.com/Stable-Baselines-Team/stable-baselines3-contrib.git@feat/ppo-lstm

# tmux and screen
tmux new -s session_name
tmux attach-session -t session_name
Ctrl+b c  # create window
Ctrl+b p  # previous window
Ctrl+b n  # next window
kinit && aklog
tmux ls
tmux kill-ses -t session_name
screen -S session_name
screen -r session_name
screen -X -S session_name quit
ctrl+a d

# .bashrc
export PS1="\e[0;32m\u@\h\e\e[0;37m:\e\e[0;34m\W\e\e[0;37m$\e[m "
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/afs/csail.mit.edu/u/s/scasper/.mujoco/mujoco210/bin
alias mac="cd ~/multiagent-competition/"
alias python="python3"
export CUDA_PATH=/usr
export LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libGLEW.so
# export LD_PRELOAD=/usr/lib/x86_64-linux-gnu/libGLEW.so:/usr/lib/nvidia-000/libGL.so
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/lib/nvidia-000  # TODO
export LD_LIBRARY_PATH=$HOME/.mujoco/mujoco210/bin:$LD_LIBRARY_PATH
# export PATH=/usr/local/cuda-11.6/bin${PATH:+:${PATH}}
# export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/lib/nvidia
# export LD_LIBRARY_PATH=/usr/local/cuda-11.3/lib:$LD_LIBRARY_PATH
# export PATH=/usr/local/cuda-11.3/bin:$PATH
function tns(){
        tmux new -s $1
}
function tas() {
    tmux attach-session -t $1
}

# cuda and stuff
# https://docs.nvidia.com/cuda/cuda-installation-guide-linux/index.html
# https://developer.nvidia.com/cuda-11-3-1-download-archive
sudo apt update
sudo apt-get install linux-headers-$(uname -r)
curl -O https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/cuda-ubuntu2004.pin
sudo mv cuda-ubuntu2004.pin /etc/apt/preferences.d/cuda-repository-pin-600
wget https://developer.download.nvidia.com/compute/cuda/11.3.1/local_installers/cuda-repo-ubuntu2004-11-3-local_11.3.1-465.19.01-1_amd64.deb
sudo dpkg -i cuda-repo-ubuntu2004-11-3-local_11.3.1-465.19.01-1_amd64.deb
sudo apt-key add /var/cuda-repo-ubuntu2004-11-3-local/7fa2af80.pub
sudo apt-get update  # might need to sudo rm something if it can't be parsed
sudo apt-get -y install cuda
sudo reboot

# mujoco and baselines stuff
sudo apt-get install ffmpeg
sudo mkdir /usr/lib/nvidia-000
sudo apt-get install libglfw3
sudo apt-get install libglfw3-dev
sudo apt-get install mesa-utils
sudo apt install cuda-toolkit-11-3
sudo apt-get install cuda
sudo apt-get install cuda-drivers

































# ssh
ssh scasper@satori-login-001.mit.edu

# interactive on supercloud
LLsub -i -s 8 -g volta:1
LLsub -i -s 8

# make env on supercloud
cd
module load anaconda/2022a
conda create -y -c menpo -n mac python=3.8 libglvnd-glx-cos7-x86_64 mesa-libgl-devel-cos6-x86_64 glfw3
conda activate mac
mkdir /state/partition1/user/$USER
export TMPDIR=/state/partition1/user/$USER
pip install patchelf stable-baselines3 numpy gym scipy matplotlib torch Cython mujoco>=2.1
rm -rf /state/partition1/user/$USER
mkdir .mujoco
cd .mujoco
wget https://mujoco.org/download/mujoco210-linux-x86_64.tar.gz
tar -vxf *.gz
mkdir /state/partition1/user/scasper/
cd /state/partition1/user/scasper/
git clone https://github.com/openai/mujoco-py.git
cd mujoco-py
python setup.py install --user
cd ..
mv mujoco-py ~

# and then to load it or whatever in a script
cd
module load anaconda/2022a
module load cuda/10.0
conda activate mac
rm -r -f /state/partition1/user/scasper/
mkdir /state/partition1/user/scasper/
cd /state/partition1/user/scasper/
cp -r ~/mujoco-py .
cd mujoco-py
python setup.py install
python -c 'import mujoco_py'



